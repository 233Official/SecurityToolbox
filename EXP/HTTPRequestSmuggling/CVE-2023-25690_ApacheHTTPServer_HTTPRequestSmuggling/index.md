# HTTP 请求走私\_ApacheHTTPServer_CVE-2023-25690

- [最有价值的参考资料及 poc](https://github.com/dhmosfunk/CVE-2023-25690-POC)
- [漏洞修复 commit](https://github.com/apache/httpd/commit/d78a166fedd9d02c23e4b71d5f53bd9b2c4b9a51#diff-c79653a5ec3ccb8725b180419680b328e34ab9a0a7f453208d79570448860a6a)
- [有价值的分析文章](https://xz.aliyun.com/t/12345)
- [通告](https://english.venustech.com.cn/new_type/aqtg/20230308/25280.html)

---

## 环境搭建

从 Github 拉取 [dhmosfunk/CVE-2023-25690-POC: CVE 2023 25690 Proof of concept - mod_proxy vulnerable configuration on Apache HTTP Server versions 2.4.0 - 2.4.55 leads to HTTP Request Smuggling vulnerability](https://github.com/dhmosfunk/CVE-2023-25690-POC)

```bash
git clone https://github.com/dhmosfunk/CVE-2023-25690-POC.git
code CVE-2023-25690-POC
```

通过 `docker-compose.yml` 构建复现环境

```bash
cd lab
docker compose up --build
```

> 总是会卡在最后一步出错导致环境无法成功启动, 因此放弃使用该 docker 搭建漏洞环境  
> ![image-20230825161637400](http://cdn.ayusummer233.top/DailyNotes/202308251616147.png)

---

由于漏洞的受影响版本为 2.4.0 ≤ Apache HTTP Server ≤ 2.4.55, 看了下 vulhub 里 `Apache HTTP Server 2.4.48 mod_proxy SSRF漏洞(CVE-2021-40438) ` 符合该范围, 因此尝试使用该 docker 进行魔改来搭建此漏洞的复现环境

```bash
cd httpd/CVE-2021-40438
docker compose build
docker compose up -d
```

之后进入容器中魔改配置, 打开 `/usr/local/apache2/conf/httpd.conf`, 加入:

```properties
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

<VirtualHost *:80>

    ServerName localhost
    DocumentRoot /usr/local/apache2/htdocs

    RewriteEngine on
    RewriteRule "^/categories/(.*)" "http://192.168.1.215:9220/categories.php?id=$1" [P]
    ProxyPassReverse "/categories/" "http://192.168.1.215:9220/"

</VirtualHost>
```

![image-20230825161730994](http://cdn.ayusummer233.top/DailyNotes/202308251617463.png)

重启 docker

![image-20230825134941237](http://cdn.ayusummer233.top/DailyNotes/202308251617459.png)

然后该配置即可生效
